(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[22],{o3Nl:function(e,t,n){"use strict";n.d(t,"a",(function(){return re}));var r=n("NthX"),c=n.n(r),i=n("UO5U"),a=n("oYCi"),o=n("mK0O"),s=n("eijD"),l=n("aNYv"),u=n("mXGw"),d=n("7Hz8"),j=n("DdxA"),b=n("qf77"),f=n("tpsD"),p=n("u9PO"),O=n("ByLR"),h=n("ogkY"),x=n("DK0r"),g=n("6h0R"),m=n("/JLY"),y=n("A4YR"),v=n("vr+m"),w=n("fIze"),k=n.n(w),C=n("5dyF"),D=n.n(C),R=n("cpxy"),S=(n("S3Lu"),n("Nhdc")),A=n("oV6d"),E=n("dV/x"),I=n("NWgQ"),P=n.n(I),_=n("B5kz"),M=n("dAGg"),z=n.n(M),T=n("RKBc"),F=n.n(T),N=n("/wep"),W=n("fudW"),V=n("jqpl"),H=n("EBWJ"),L=n("XFcN"),Y=n("E6v7"),B=n("4lgx"),U=n("VZ18"),G=n("eZYV"),q=n("IDQp");function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=Object(u.forwardRef)((function(e,t){var n=e.currentlyVisible,r=e.truncatedTemplate,i=e.imageId,d=e.containerSize,j=e.shouldRender,b=e.onVisible,f=e.refetch,p=e.contextMenuElements,h=e.onContextMenuActionComplete,x=e.styles,g=Object(E.a)(e,["currentlyVisible","truncatedTemplate","imageId","containerSize","shouldRender","onVisible","refetch","contextMenuElements","onContextMenuActionComplete","styles"]),m=Object(u.useRef)(null),y=Object(B.useSession)(),v=Object(l.a)(y,1)[0],w=Object(L.e)().templateEditorStore,k=Object(G.d)(),C=Object(_.useQuery)(["template",r.id,i],Object(s.a)(c.a.mark((function e(){var t,n,a,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=P.a.stringify(Object(o.a)({},"image-id",i),{skipNull:!0}),e.next=3,k(N.a.get("/templates/".concat(r.id,"?").concat(n)),{skipErrorHandling:function(e){var t,n,r;return 404===(null===(t=e.response)||void 0===t?void 0:t.status)||"IMAGE_ID_ERROR"===(null===(n=e.response)||void 0===n||null===(r=n.data.errors[0])||void 0===r?void 0:r.code)}});case 3:if(a=e.sent,s=a.data,l=a.status,u=a.apiErrors,404!==l){e.next=11;break}z.a.replace("/404"),e.next=16;break;case 11:if(!u||"IMAGE_ID_ERROR"!==(null===(t=u[0])||void 0===t?void 0:t.code)){e.next=15;break}z.a.replace("/design-not-found"),e.next=16;break;case 15:return e.abrupt("return",null===s||void 0===s?void 0:s.data);case 16:case"end":return e.stop()}}),e)}))),{refetchOnMount:f}),D=C.isLoading,R=C.data,A=Object(V.adaptSizeToAspectRatio)(r.aspectRatio,{width:d.width,height:Math.max(d.height-60,0)});function I(e,t){h&&h(e,t)}return Object(u.useEffect)((function(){R&&n&&b(R)}),[R,n,b]),Object(u.useImperativeHandle)(t,(function(){return{download:function(){return Object(s.a)(c.a.mark((function e(){var t,n,r,a,o,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=null===v||void 0===v||null===(t=v.user)||void 0===t||null===(n=t.subscriptions)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.active)){e.next=11;break}return w.setProcessing(!0),e.next=5,k(Object(U.a)(R.id,i));case 5:o=e.sent,s=o.data,F.a.saveAs(s,Object(H.a)(R.name,"png")),w.setProcessing(!1),e.next=13;break;case 11:null===(u=null===(l=m.current)||void 0===l?void 0:l.toCanvas(K(K({},A),{},{x:0,y:0,mimeType:"image/png",quality:1,pixelRatio:Object(Y.a)(A)})))||void 0===u||u.toBlob((function(e){F.a.saveAs(e,Object(H.a)(R.name,"png"))}));case 13:return e.abrupt("return",null!==a&&void 0!==a&&a);case 14:case"end":return e.stop()}}),e)})))()}}})),j?Object(a.jsxs)(O.e,K(K({flexDirection:"column",alignItems:"center"},x),{},{children:[Object(a.jsx)(S.ConditionalWrapper,{condition:!i&&!!p&&p.length>0,wrapper:function(e){return Object(a.jsx)(S.ContextMenu,{elements:null!==p&&void 0!==p?p:[],breakPoint:"lg",onActionComplete:I,children:e})},children:Object(a.jsx)(W.a,K({ref:m,loading:D,template:R,canvasSize:A,shouldRender:j},g))}),Object(a.jsx)(O.o,{isTruncated:!0,width:Object(q.a)(A).width,textAlign:"center",color:"gray.500",fontSize:"sm",height:"".concat(60,"px"),pt:2,children:R&&R.name})]})):Object(a.jsx)(a.Fragment,{})})),X=n("HMY0");function Z(){var e=Object(i.a)(["\n              .carousel-root {\n                width: 100%;\n                flex-grow: 1;\n              }\n\n              .carousel,\n              .carousel .slider-wrapper,\n              .carousel .slider {\n                height: 100%;\n              }\n\n              .carousel .slide {\n                background: none;\n              }\n            "]);return Z=function(){return e},e}function $(){var e=Object(i.a)(["\n                .chakra-modal__content-container {\n                  justify-content: flex-end !important;\n                }\n              "]);return $=function(){return e},e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=Object(d.d)(j.a,{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",position:"absolute",top:{base:"-16px",lg:"-30px"},fontSize:{base:"24px",md:"48",lg:"60px"},zIndex:5,color:"gray.400"}}),re=function(e){var t=e.category,n=e.currentTemplateId,r=e.imageId,i=e.onTemplateChange,o=e.onTemplateUpdate,d=e.onTemplateDelete,w=Object(B.useSession)(),C=Object(l.a)(w,1)[0],E=Object(M.useRouter)(),I=Object(b.b)(),_=Object(u.useRef)(),z=t.templates.findIndex((function(e){return e.id===n})),T=Object(u.useState)(z>-1?z:0),F=T[0],N=T[1],W=Object(u.useState)(null),V=W[0],H=W[1],L=Object(u.useRef)(t.templates.reduce((function(e,t){return e[t.id]=Object(u.createRef)(),e}),{})),Y=r?"?iid=".concat(r):"",U=r?"/gallery/?image-id=".concat(r):"/gallery/",q="/templates/".concat(n,"/edit/").concat(Y),J=k()(),K=J.ref,ee=J.height,re=void 0===ee?1:ee,ce=J.width,ie=void 0===ce?1:ce,ae=Object(u.useState)(!1),oe=ae[0],se=ae[1],le=Object(u.useState)(!1),ue=le[0],de=le[1],je=Object(f.g)(),be=je.isOpen,fe=je.onOpen,pe=je.onClose,Oe=Object(p.a)({base:!0,lg:!1}),he=Object(u.useRef)(null),xe=Object(u.useRef)(null),ge=Object(u.useMemo)((function(){return[G.a.AUTOMATE,G.a.DOWNLOAD]}),[]),me=Object(G.e)({template:null!==V&&void 0!==V?V:void 0,renameModalRef:he,deleteModalRef:xe,mock:ge}),ye=Object(u.useState)(!0),ve=ye[0],we=ye[1],ke=Object(u.useRef)(null),Ce=Object(u.useRef)(!1);Object(u.useEffect)((function(){E.query.saved&&!_.current&&(_.current=I({id:"toast-saved-template",position:"top",duration:6e3,render:function(){return Object(a.jsx)(S.Toast,{text:"Design successfully saved."})}}),E.replace(P.a.exclude(E.asPath,["saved"]),void 0,{shallow:!0}))})),Object(u.useEffect)((function(){!1!==Ce.current&&(Ce.current=!1,we(!1),ke.current=F,N(-1),setTimeout((function(){if(null!==ke.current){var e=ke.current+1>=t.templates.length?t.templates.length-1:ke.current;N(e),i(t.templates[e].id),we(!0)}}),0))}),[t,F,i]);var De=Object(u.useCallback)((function(){_.current&&I.close(_.current)}),[I]);function Re(){De(),se(!0),Object(A.b)("automate_from_preview","website_automation")}function Se(e){H(e)}function Ae(){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:V&&(null===(t=L.current[V.id].current)||void 0===t||t.download().then((function(e){return!e&&de(!0)})),Object(A.b)("download_from_preview","image"),Object(A.a)(V.id));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,n){var r=t.templates.length;return n===e||n===(e-1<0?r-1:e-1)||n===(e+1>r-1?0:e+1)}function Pe(e){var t;return!(null===C||void 0===C||null===(t=C.user)||void 0===t||!t.id)&&C.user.id===e.userId}function _e(){return(_e=Object(s.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return pe(),e.next=3,t.action(n);case 3:r=e.sent,Me(t.type,r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t){e!==G.a.AUTOMATE?e!==G.a.DOWNLOAD?t&&t.success&&(e===G.a.RENAME&&V?o(te(te({},V),{},{name:t.data})):e===G.a.DELETE&&V&&(Ce.current=!0,d(V.id))):Ae():Re()}Object(u.useEffect)((function(){return De}),[De]);var ze=t.templates.length;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(O.e,{flexDir:"column",height:"100%",children:[!r&&V&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(S.RenameModal,{ref:he,template:V}),Object(a.jsx)(S.DeleteModal,{ref:xe,template:V})]}),!r&&Oe&&be&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(g.a,{styles:Object(g.b)($())}),Object(a.jsxs)(h.g,{isOpen:be,onClose:pe,size:"full",motionPreset:"none",children:[Object(a.jsx)(h.m,{}),Object(a.jsxs)(h.j,{m:0,borderRadius:0,width:"auto",children:[Object(a.jsx)(h.l,{}),Object(a.jsx)(h.i,{size:"lg"}),Object(a.jsx)(h.h,{px:8,my:6,children:Object(a.jsx)(O.j,{display:"flex",flexDir:"column",color:"gray.600",spacing:2,children:me.map((function(e,t){return Object(a.jsx)(O.k,{children:Object(a.jsx)(j.a,{variant:"unstyled",display:"block",fontWeight:"normal",height:"auto",width:"100%",textAlign:"left",py:1,onClick:function(t){return function(e,t){return _e.apply(this,arguments)}(e,t)},children:e.text})},t)}))})})]})]})]}),Object(a.jsxs)(O.c,{display:"flex",maxW:"container.lg",justifyContent:"space-between",alignItems:"center",pt:{base:4,lg:24},pb:6,px:4,children:[Object(a.jsx)(O.a,{flex:"1 1 0px",children:Object(a.jsx)(D.a,{passHref:!0,scroll:!1,href:U,children:Object(a.jsxs)(O.i,{_hover:{textDecoration:"none"},variant:"unstyled",display:"flex",alignItems:"center",color:"gray.600",fontWeight:"700",children:[Object(a.jsx)(m.a,{size:18}),Object(a.jsx)(O.o,{isTruncated:!0,maxWidth:{base:140,lg:"unset"},ml:1.5,children:"All Designs"})]})})}),Oe&&Object(a.jsx)(a.Fragment,{children:C&&!r&&me.length>0?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(O.e,{flex:"1 1 0px",justifyContent:"center",children:Object(a.jsx)(D.a,{href:"/",passHref:!0,children:Object(a.jsx)(O.i,{children:Object(a.jsx)(x.b,{alt:"Designify",height:{base:"28px",lg:"32px"},display:{base:"block",lg:"none"},src:"/logo_color.svg"})})})}),Object(a.jsx)(O.a,{flex:"1 1 0px",textAlign:"right",children:Object(a.jsx)(j.a,{variant:"unstyled",onClick:fe,children:Object(a.jsx)(O.e,{p:3,gridGap:1,display:{base:"flex",lg:"none"},children:Array.from({length:3}).map((function(e,t){return Object(a.jsx)(O.a,{w:".25rem",height:".25rem",borderRadius:"50%",bgColor:"black"},t)}))})})})]}):Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(D.a,{href:"/",passHref:!0,children:Object(a.jsx)(O.i,{children:Object(a.jsx)(x.b,{alt:"Designify",height:{base:"28px",lg:"32px"},display:{base:"block",lg:"none"},src:"/designify_logo_color_dark.svg"})})})})})]}),Object(a.jsxs)(O.c,{ref:K,flex:"1",display:"flex",maxW:"container.lg",overflow:"hidden",justifyContent:"center",alignItems:"center",position:"relative",px:{base:4,md:12,lg:16},children:[Object(a.jsx)(g.a,{styles:Object(g.b)(Z())}),t.templates.length>1&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(ne,{variant:"unstyled",left:{base:"-12px",md:"-4px",lg:0},onClick:function(){N(F-1)},children:Object(a.jsx)(y.a,{})}),Object(a.jsx)(ne,{variant:"unstyled",right:{base:"-12px",md:"-4px",lg:0},onClick:function(){N(F+1)},children:Object(a.jsx)(y.b,{})})]}),Object(a.jsx)(O.a,{display:"flex",flexDirection:"column",width:"100%",height:"100%",children:ve&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(O.o,{isTruncated:!0,textAlign:"center",color:"gray.500",fontSize:"sm",pb:2,children:"".concat(t.name," ").concat(F+1," of ").concat(t.templates.length)}),Object(a.jsx)(R.Carousel,{infiniteLoop:!0,autoPlay:!1,showStatus:!1,showIndicators:!1,showThumbs:!1,showArrows:!1,selectedItem:F,onChange:function(e){N(e),i(t.templates[e].id)},children:t.templates.map((function(e,t){return Object(X.a)(F,t,ze,3)?Object(a.jsx)(Q,{ref:L.current[e.id],currentlyVisible:F===t,shouldRender:Ie(F,t),truncatedTemplate:e,imageId:r,containerSize:{width:ie,height:re-30},onVisible:Se,refetch:Pe(e),contextMenuElements:me,onContextMenuActionComplete:Me,styles:{height:"100%",justifyContent:"center"}},e.id):Object(a.jsx)(O.a,{},e.id)}))})]})})]}),Object(a.jsxs)(O.e,{justifyContent:"center",pt:4,pb:{base:4,lg:6},children:[Object(a.jsx)(D.a,{passHref:!0,href:q,children:Object(a.jsxs)(O.i,{_hover:{textDecoration:"none"},textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",alignItems:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},color:"gray.900",fontWeight:"600",onClick:function(){Object(A.b)("edit_from_preview","editor",!1)},children:[Object(a.jsx)(v.r,{color:"gray.900",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Edit"]})}),Object(a.jsxs)(j.a,{variant:"unstyled",textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},mx:{base:8,lg:20},onClick:Re,children:[Object(a.jsx)(v.f,{color:"gray.900",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Start Batch"]}),Object(a.jsxs)(j.a,{variant:"unstyled",textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},onClick:Ae,children:[Object(a.jsx)(v.p,{color:"palette.2",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Download"]})]})]}),V&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(S.AutomationModal,{template:V,open:oe,onClose:function(){se(!1)}}),Object(a.jsx)(S.Confetti,{active:ue}),Object(a.jsx)(S.DownloadModal,{open:ue,onClose:function(){de(!1)},template:V,redirectUrl:"/pricing"})]})]})}}}]);